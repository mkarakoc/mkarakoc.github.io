<!doctype html>
<html>
    <body>
        <a id="comic-link" href="#" target="_blank">
            <img id="comic" src="" alt="">
        </a>
        <script>
            const maxComicNum = 2500; // The highest XKCD comic number available
            const randomComicNum = Math.floor(Math.random() * maxComicNum) + 1;
            const randomComicUrl = `https://xkcd.com/${randomComicNum}/info.0.json`;
            fetch(randomComicUrl)
                .then(response => response.json())
                .then(data => {
                    const comicUrl = data.img;
                    const comicTitle = data.title;
					                // Get the image size
                const img = new Image();
                img.src = comicUrl;
                img.onload = function() {
                    const imgWidth = img.width;
                    const imgHeight = img.height;
                    let newWidth, newHeight;
                    
                    // Scale down the image while maintaining aspect ratio
                    if (imgWidth > imgHeight) {
                        newWidth = 382;
                        newHeight = Math.round((imgHeight / imgWidth) * newWidth);
                    } else {
                        newHeight = 382;
                        newWidth = Math.round((imgWidth / imgHeight) * newHeight);
                    }
                    
                    // Update the image size and URL
                    document.getElementById("comic").src = comicUrl;
                    document.getElementById("comic").width = newWidth;
                    document.getElementById("comic").height = newHeight;
                    document.getElementById("comic-link").href = `https://xkcd.com/${randomComicNum}`;
                    document.getElementById("comic-link").title = comicTitle;
                }
            })
            .catch(error => console.error(error));
    </script>        
</body>
</html>